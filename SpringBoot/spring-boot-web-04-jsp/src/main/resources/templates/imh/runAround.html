<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>数据统计表</title>
    <title></title>
    <!-- 如果不使用base,那么这种方式也是可以的,@{/你的文件路径},缺陷就是每次引用都必须带上th:src="@{/}"这个才能正确引用,具体用什么方式,看你们自己 -->
    <link rel="stylesheet" th:href="@{/assets/libs/layui/css/layui.css}">
    <script type="text/javascript" th:src="@{/assets/libs/layui/layui.all.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/common.js}"></script>
    <script type="text/javascript" th:src="@{/assets/libs/jquery/jquery-3.2.1.min.js}"></script>

</head>
<style>
    .layui-form-label {
        float: left;
        display: block;
        padding: 9px 15px;
        width: 80px;
        font-weight: 400;
        line-height: 20px;
        text-align: right;
        width: 6rem;
    }
</style>
<body>
<div class="layui-form-item">
    <div class="layui-inline">
        <form class="layui-form" action="" method="post " lay-filter="dataFrm" id="dataFrm">
<!--            <label class="layui-form-label">60级武器价格</label>-->
<!--            <div class="layui-input-inline" style="width: 100px;">-->
<!--                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">-->
<!--            </div>-->
<!--            <label class="layui-form-label">60级装备价格</label>-->
<!--            <div class="layui-input-inline" style="width: 100px;">-->
<!--                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">-->
<!--            </div>-->
<!--            <label class="layui-form-label">70级武器价格</label>-->
<!--            <div class="layui-input-inline" style="width: 100px;">-->
<!--                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">-->
<!--            </div>-->
<!--            <label class="layui-form-label">70级装备价格</label>-->
<!--            <div class="layui-input-inline" style="width: 100px;">-->
<!--                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">-->
<!--            </div>-->
<!--            <label class="layui-form-label">80级武器价格</label>-->
<!--            <div class="layui-input-inline" style="width: 100px;">-->
<!--                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">-->
<!--            </div>-->
<!--            <label class="layui-form-label">80级装备价格</label>-->
<!--            <div class="layui-input-inline" style="width: 100px;">-->
<!--                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">-->
<!--            </div>-->
            <div class="layui-inline">
                <button type="button" class="layui-btn layui-btn-normal layui-btn-sm layui-icon" lay-submit lay-filter="btnExp" id="btnExp">&#xe67d;开始跑环</button>
            </div>
        </form>
    </div>

    <table class="layui-table" id="mhxyRunTable" lay-filter="mhxyRunTable"></table>
</div>

<script>

    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider','form'], function () {
        var laydate = layui.laydate //日期
            , laypage = layui.laypage //分页
            , layer = layui.layer //弹层
            , table = layui.table //表格
            , carousel = layui.carousel //轮播
            , upload = layui.upload //上传
            , element = layui.element //元素操作
            , slider = layui.slider //滑块
            , form = layui.form;
        //向世界问个好
        layer.msg('Hello World');
        refreshTable();
        //渲染表格的方法
        function refreshTable() {
            ins1=table.render({
                elem: '#mhxyRunTable',
                title:"跑环积分表",
                url: '/mhxyRunAround/queryRunAround',
                page:true,
                limit:20,
                limits: [20, 40, 60,80,100],
                parseData: function(res){ //res 即为原始返回的数据
                return {
                    "code": 0, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.data.totalElements, //解析数据长度
                    "data": res.data.content //解析数据列表
                    };
                },
                cols: [[
                    {type: 'numbers', title:'序号'},
                    // {title: 'ID', field: 'id', align: 'center',   hide:true},
                    {title: '当前环数', field: 'aroundNum', align: 'center', valign: 'middle'},
                    {title: '当前积分', field: 'score', align: 'center', valign: 'middle'},
                    {title: '找人', field: 'searchPerson', align: 'center',   templet: usernameTp},
                    {title: '60武器', field: 'sixwq', align: 'center',   templet: usernameTp},
                    {title: '60装备', field: 'sixzb', align: 'center',   templet: usernameTp},
                    {title: '70武器', field: 'sevenwq', align: 'center',   templet: usernameTp},
                    {title: '70装备', field: 'sevenzb', align: 'center',   templet: usernameTp},
                    {title: '80武器', field: 'eightwq', align: 'center',   templet: usernameTp},
                    {title: '80装备', field: 'eightzb', align: 'center',   templet: usernameTp},
                    {title: 'BY', field: 'by', align: 'center',   templet: usernameTp},
                    {title: '指定BY', field: 'zhiBy', align: 'center',   templet: usernameTp},
                    {title: '花费MHB', field: 'moneyForMH', align: 'center',   templet: usernameTp},
                    {title: '所在区比例', field: 'goldPrice', align: 'center',   templet: usernameTp},
                    {title: '现金', field: 'moneyForRMB', align: 'center', valign: 'middle'}
                ]]
            });
        }
        var firstParam = {
            aroundNum:0,
            searchPerson:0,
            sixwq:0,
            sixzb:0,
            sevenwq:0,
            sevenzb:0,
            eightwq:0,
            eightzb:0,
            BY:0,
            zhiBy:0,
            score:0,
            moneyForMH:0,
            goldPrice:0,
            moneyForRMB:0
        }
        // 添加事件
        $('#btnExp').click(function () {
            form.on("submit(btnExp)",function (obj) {
                $.ajax({
                    url: "/mhxyRunAround/saveRunAround",
                    data:firstParam,
                    type: 'get',
                    contentType: 'application/json',
                    dataType: 'json',
                    async: false, // 同步
                    success: function (result) {
                        refreshTable();
                    },
                    error: function (result) {
                    }
                });
            })
        });
        //给单元格加颜色
        function usernameTp(d){
            var a = this.field;
            console.log(a)
            var html="";
            html = '<u style="color:#1E9FFF">'+d[a]+'</u>' +
                '<a class="layui-btn layui-btn-primary layui-btn-xs" style="margin-left: 0.8rem;" lay-event='+a+'>+</a>' +
                '<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">-</a>' ;
            if('goldPrice'==this.field){
                html = '<u style="color:#1E9FFF">'+d[a]+'</u>' +
                    '<a class="layui-btn layui-btn-primary layui-btn-xs" style="margin-left: 0.8rem;" lay-event='+a+'>修改</a>';
            }
            return html;
        }
        //监听单元格事件
        table.on('tool(mhxyRunTable)', function(obj){
            var event = obj.event;
            console.log(obj);

        });


    });
</script>
</body>

</html>